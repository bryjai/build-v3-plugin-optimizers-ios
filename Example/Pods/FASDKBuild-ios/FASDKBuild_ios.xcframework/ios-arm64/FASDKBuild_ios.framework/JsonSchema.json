{
    "$schema": "http://json-schema.org/draft-07/schema#",
    "type": "object",
    "definition": {
        "image": {
            "type": "object",
            "properties": {
                "type": {
                    "type": "string",
                    "enum": ["remote", "local"]
                }
            },
            "allOf": [{
                "if": {
                    "properties": {
                        "type": {
                            "const": "remote"
                        }
                    }
                },
                "then": {
                    "properties": {
                        "url": {
                            "type": "string",
                            "format": "uri"
                        }
                    },
                    "required": ["url"]
                },
                "else": {
                    "properties": {
                        "filename": {
                            "type": "string"
                        }
                    },
                    "required": ["filename"]
                }
            }]
        },
        "navigation_bar": {
            "type": "object",
            "properties": {
                "show_navigation_bar": {
                    "type": "boolean"
                }
            },
            "allOf": [{
                "if": {
                    "properties": {
                        "show_navigation_bar": {
                            "const": true
                        }
                    }
                },
                "then": {
                    "properties": {
                        "title_type": {
                            "enum": ["section_title", "image"]
                        },
                        "title_position": {
                            "enum": ["center", "left"]
                        }
                    },
                    "allOf": [{
                        "if": {
                            "properties": {
                                "title_type": {
                                    "const": "image"
                                }
                            }
                        },
                        "then": {
                            "properties": {
                                "image": {
                                    "$ref": "#/definition/image"
                                }
                            },
                            "required": ["image"]
                        }
                    }],
                    "required": ["title_type", "title_position"]
                }
            }],
            "required": ["show_navigation_bar"]
        },
        "navigation_bar_button": {
            "type": "object",
            "properties": {
                "type": {
                    "type": "string",
                    "enum": ["back", "menu", "toggle", "shortcut", "cart", "voice_search", "barcode_scanner", "native_callback"]
                },
                "identifier": {
                    "type": "string"
                }
            },
            "allOf": [{
                    "if": {
                        "properties": {
                            "type": {
                                "const": "back"
                            }
                        }
                    },
                    "then": {
                        "properties": {
                            "icon": {
                                "$ref": "#/definition/image"
                            },
                            "active_icon": {
                                "$ref": "#/definition/image"
                            }
                        },
                        "required": ["icon"]
                    }
                },
                {
                    "if": {
                        "properties": {
                            "type": {
                                "const": "menu"
                            }
                        }
                    },
                    "then": {
                        "properties": {
                            "menu_type": {
                                "type": "string",
                                "enum": ["js_selector", "js_script", "hamburger"]
                            }
                        },
                        "allOf": [{
                                "if": {
                                    "properties": {
                                        "menu_type": {
                                            "const": "js_selector"
                                        }
                                    }
                                },
                                "then": {
                                    "properties": {
                                        "js_selector": {
                                            "type": "string"
                                        },
                                        "hide_button_when_not_available": {
                                            "type": "boolean"
                                        },
                                        "icon": {
                                            "$ref": "#/definition/image"
                                        }
                                    },
                                    "required": ["js_selector", "hide_button_when_not_available", "icon"]
                                }
                            },
                            {
                                "if": {
                                    "properties": {
                                        "menu_type": {
                                            "const": "js_script"
                                        }
                                    }
                                },
                                "then": {
                                    "properties": {
                                        "js_script": {
                                            "type": "string"
                                        },
                                        "icon": {
                                            "$ref": "#/definition/image"
                                        }
                                    },
                                    "required": ["js_script", "icon"]
                                }
                            },
                            {
                                "if": {
                                    "properties": {
                                        "menu_type": {
                                            "const": "hamburger"
                                        }
                                    }
                                },
                                "then": {
                                    "properties": {
                                        "menu_items": {
                                            "type": "array",
                                            "items": {
                                                "type": "object",
                                                "properties": {
                                                    "title": {
                                                        "type": "string"
                                                    },
                                                    "link": {
                                                        "type": "string",
                                                        "format": "uri"
                                                    },
                                                    "image": {
                                                        "$ref": "#/definition/image"
                                                    }
                                                },
                                                "required": ["link"]
                                            }
                                        },
                                        "icon": {
                                            "$ref": "#/definition/image"
                                        }
                                    },
                                    "required": ["menu_items", "icon"]
                                }
                            }
                        ],
                        "required": ["menu_type"]
                    }
                },
                {
                    "if": {
                        "properties": {
                            "type": {
                                "const": "toggle"
                            }
                        }
                    },
                    "then": {
                        "properties": {
                            "toggle_type": {
                                "type": "string",
                                "enum": ["js_selector", "js_script"]
                            }
                        },
                        "allOf": [{
                                "if": {
                                    "properties": {
                                        "toggle_type": {
                                            "const": "js_selector"
                                        }
                                    }
                                },
                                "then": {
                                    "properties": {
                                        "js_selector": {
                                            "type": "string"
                                        },
                                        "hide_button_when_not_available": {
                                            "type": "boolean"
                                        },
                                        "icon": {
                                            "$ref": "#/definition/image"
                                        }
                                    },
                                    "required": ["js_selector", "hide_button_when_not_available", "icon"]
                                }
                            },
                            {
                                "if": {
                                    "properties": {
                                        "toggle_type": {
                                            "const": "js_script"
                                        }
                                    }
                                },
                                "then": {
                                    "properties": {
                                        "js_script": {
                                            "type": "string"
                                        },
                                        "icon": {
                                            "$ref": "#/definition/image"
                                        }
                                    },
                                    "required": ["js_script", "icon"]
                                }
                            }
                        ],
                        "required": ["toggle_type"]
                    }
                },
                {
                    "if": {
                        "properties": {
                            "type": {
                                "const": "shortcut"
                            }
                        }
                    },
                    "then": {
                        "properties": {
                            "url": {
                                "type": "string",
                                "format": "uri"
                            },
                            "icon": {
                                "$ref": "#/definition/image"
                            }
                        },
                        "required": ["url", "icon"]
                    }
                },
                {
                    "if": {
                        "properties": {
                            "type": {
                                "const": "cart"
                            }
                        }
                    },
                    "then": {
                        "properties": {
                            "show_0": {
                                "type": "boolean"
                            },
                            "counter_badge_type": {
                                "type": "string",
                                "enum": ["right", "center", "badge", "none"]
                            },
                            "tap_action_type": {
                                "type": "string",
                                "enum": ["url", "script"]
                            },
                            "icon": {
                                "$ref": "#/definition/image"
                            }
                        },
                        "allOf": [{
                                "if": {
                                    "properties": {
                                        "counter_badge_type": {
                                            "const": "badge"
                                        }
                                    }
                                },
                                "then": {
                                    "properties": {
                                        "counter_badge_color": {
                                            "type": "string"
                                        }
                                    },
                                    "required": ["counter_badge_color"]
                                }
                            },
                            {
                                "if": {
                                    "properties": {
                                        "tap_action_type": {
                                            "const": "url"
                                        }
                                    }
                                },
                                "then": {
                                    "properties": {
                                        "url": {
                                            "type": "string",
                                            "format": "uri"
                                        }
                                    },
                                    "required": ["url"]
                                },
                                "else": {
                                    "properties": {
                                        "script": {
                                            "type": "string"
                                        }
                                    },
                                    "required": ["script"]
                                }
                            }
                        ],
                        "required": ["counter_badge_type", "tap_action_type", "icon", "show_0"]
                    }
                },
                {
                    "if": {
                        "properties": {
                            "type": {
                                "const": "voice_search"
                            }
                        }
                    },
                    "then": {
                        "properties": {
                            "language": {
                                "type": "string"
                            },
                            "url_pattern": {
                                "type": "string"
                            },
                            "icon": {
                                "$ref": "#/definition/image"
                            }
                        },
                        "required": ["url_pattern", "language", "icon"]
                    }
                },
                {
                    "if": {
                        "properties": {
                            "type": {
                                "const": "barcode_scanner"
                            }
                        }
                    },
                    "then": {
                        "properties": {
                            "url_pattern": {
                                "type": "string"
                            },
                            "icon": {
                                "$ref": "#/definition/image"
                            }
                        },
                        "required": ["url_pattern", "icon"]
                    }
                },
                {
                    "if": {
                        "properties": {
                            "type": {
                                "const": "native_callback"
                            }
                        }
                    },
                    "then": {
                        "properties": {
                            "icon": {
                                "$ref": "#/definition/image"
                            },
                            "active_icon": {
                                "$ref": "#/definition/image"
                            }
                        },
                        "required": ["identifier", "icon"]
                    }
                }
            ]
        },
        "navigation_bar_button_multistate": {
            "type": "object",
            "properties": {
                "state_script": {
                    "type": "string"
                },
                "states": {
                    "type": "array",
                    "items": {
                        "#ref": "#/definitions/navigation_bar_button"
                    }
                },
                "identifier": {
                    "type": "string"
                }
            },
            "additionalProperties": false
        },
        "web_contents": {
            "type": "object",
            "properties": {
                "shopping_cart_counter_selector": {
                    "type": "string"
                },
                "selectors_to_remove": {
                    "type": "array",
                    "items": {
                        "type": "object",
                        "properties": {
                            "label": {
                                "type": "string"
                            },
                            "selector_to_remove": {
                                "type": "string"
                            },
                            "sub_selector_to_check": {
                                "type": "string"
                            },
                            "innerHTML_to_check": {
                                "type": "string"
                            }
                        },
                        "required": ["label", "selector_to_remove"]
                    }
                },
                "css": {
                    "type": "array",
                    "items": {
                        "type": "object",
                        "properties": {
                            "label": {
                                "type": "string"
                            },
                            "selector": {
                                "type": "string"
                            },
                            "properties": {
                                "type": "string"
                            }
                        },
                        "required": ["label", "selector", "properties"]
                    }
                },
                "scripts": {
                    "type": "array",
                    "items": {
                        "type": "object",
                        "properties": {
                            "label": {
                                "type": "string"
                            },
                            "script": {
                                "type": "string"
                            },
                            "execution": {
                                "type": "string",
                                "enum": ["document_start", "document_end", "continuous"]
                            }
                        },
                        "required": ["label", "script", "execution"]
                    }
                }
            },
            "additionalProperties": false
        },
        "url_matcher": {
            "type": "object",
            "properties": {
                "expression": {
                    "type": "string"
                },
                "match_type": {
                    "type": "string",
                    "enum": ["substring", "prefix", "suffix", "equal"]
                }
            },
            "required": ["expression", "match_type"],
            "additionalProperties": true
        },
        "external_link_policy": {
            "type": "string",
            "enum": ["current_webview", "modal_webview", "inapp_browser", "outside_of_app"]
        },
        "external_link_policy_set": {
            "type": "object",
            "properties": {
                "same_domain": {
                    "$ref": "#/definition/external_link_policy"
                },
                "different_domain": {
                    "$ref": "#/definition/external_link_policy"
                },
                "custom": {
                    "type": "array",
                    "items": {
                        "type": "object",
                        "allOf": [{
                                "$ref": "#/definition/url_matcher"
                            },
                            {
                                "properties": {
                                    "presentation_mode": {
                                        "$ref": "#/definition/external_link_policy"
                                    }
                                },
                                "required": ["presentation_mode"]
                            }
                        ]
                    }
                }
            },
            "required": [],
            "additionalProperties": false
        },
        "sections_loading": {
            "type": "object",
            "properties": {
                "default_section": {
                    "type": "number"
                },
                "start_loading_order": {
                    "type": "array",
                    "items": {
                        "type": "array",
                        "items": {
                            "type": "number"
                        }
                    }
                }
            },
            "required": ["default_section", "start_loading_order"]
        },
        "section": {
            "type": "object",
            "properties": {
                "title": {
                    "type": "string"
                },
                "image": {
                    "$ref": "#/definition/image"
                },
                "active_image": {
                    "$ref": "#/definition/image"
                },
                "type": {
                    "type": "string",
                    "enum": ["url", "media_library", "login_page"]
                },
                "url": {
                    "type": "string"
                },
                "navigation_bar": {
                    "$ref": "#/definition/navigation_bar"
                },
                "loading_percentage_before_show": {
                    "type": "number"
                },
                "allow_scroll_while_loading": {
                    "type": "boolean"
                },
                "pull_to_refresh": {
                    "type": "boolean"
                },
                "show_transition_loader": {
                    "type": "boolean"
                },
                "prevent_zooming": {
                    "type": "boolean"
                },
                "navigation_bar_buttons": {
                    "type": "object",
                    "properties": {
                        "left_buttons": {
                            "type": "array",
                            "items": {
                                "anyOf": [{
                                        "$ref": "#/definition/navigation_bar_button"
                                    },
                                    {
                                        "$ref": "#/definition/navigation_bar_button_multistate"
                                    }
                                ]
                            }
                        },
                        "right_buttons": {
                            "type": "array",
                            "items": {
                                "anyOf": [{
                                        "$ref": "#/definition/navigation_bar_button"
                                    },
                                    {
                                        "$ref": "#/definition/navigation_bar_button_multistate"
                                    }
                                ]
                            }
                        }
                    },
                    "required": ["left_buttons", "right_buttons"]
                },
                "web_content": {
                    "$ref": "#/definition/web_contents"
                },
                "features": {
                    "type": "array",
                    "items": {
                        "type": "object",
                        "properties": {
                            "type": {
                                "type": "string",
                                "enum": ["cart", "voice_search", "barcode_scanner"]
                            }
                        },
                        "allOf": [{
                                "if": {
                                    "properties": {
                                        "type": {
                                            "const": "cart"
                                        }
                                    }
                                },
                                "then": {
                                    "properties": {
                                        "show_0": {
                                            "type": "boolean"
                                        }
                                    },
                                    "required": ["show_0"]
                                }
                            },
                            {
                                "if": {
                                    "properties": {
                                        "type": {
                                            "const": "voice_search"
                                        }
                                    }
                                },
                                "then": {
                                    "properties": {
                                        "position": {
                                            "type": "string",
                                            "enum": ["bottom_right", "bottom_left", "top_right", "top_left"]
                                        },
                                        "icon": {
                                            "$ref": "#/definition/image"
                                        },
                                        "language": {
                                            "type": "string"
                                        },
                                        "url_pattern": {
                                            "type": "string"
                                        }
                                    },
                                    "required": ["position", "language", "url_pattern", "icon"]
                                }
                            },
                            {
                                "if": {
                                    "properties": {
                                        "type": {
                                            "const": "barcode_scanner"
                                        }
                                    }
                                },
                                "then": {
                                    "properties": {
                                        "position": {
                                            "type": "string",
                                            "enum": ["bottom_right", "bottom_left", "top_right", "top_left"]
                                        },
                                        "url_pattern": {
                                            "type": "string"
                                        }
                                    },
                                    "required": ["position", "url_pattern"]
                                }
                            }
                        ],
                        "required": ["type"]
                    }
                },
                "handles_urls": {
                    "type": "array",
                    "items": {
                        "$ref": "#/definition/url_matcher"
                    }
                },
                "external_links": {
                    "$ref": "#/definition/external_link_policy_set"
                }
            },
            "required": [
                "type", "loading_percentage_before_show",
                "allow_scroll_while_loading", "show_transition_loader", "prevent_zooming",
                "navigation_bar_buttons", "web_content", "features"
            ],
            "additionalProperties": false
        },
        "logged_in_check": {
            "type": "object",
            "properties": {
                "check_type": {
                    "type": "string",
                    "enum": ["js_script", "matcher"]
                }
            },
            "allOf": [{
                    "if": {
                        "properties": {
                            "check_type": {
                                "const": "js_script"
                            }
                        }
                    },
                    "then": {
                        "script": {
                            "type": "string"
                        },
                        "required": ["script"]
                    }
                },
                {
                    "if": {
                        "properties": {
                            "check_type": {
                                "const": "matcher"
                            }
                        }
                    },
                    "then": {
                        "login_success_check": {
                            "$ref": "#/definition/url_matcher"
                        },
                        "logout_check": {
                            "$ref": "#/definition/url_matcher"
                        },
                        "required": ["login_success_check", "logout_check"]
                    }
                }
            ],
            "required": ["check_type"]
        },
        "style": {
            "type": "object",
            "properties": {
                "global_background_color": {
                    "type": "string"
                },
                "tab_bar_background_color": {
                    "type": "string"
                },
                "tab_bar_selected_color": {
                    "type": "string"
                },
                "tab_bar_unselected_color": {
                    "type": "string"
                },
                "tab_bar_badge_color": {
                    "type": "string"
                },
                "nav_bar_background_color": {
                    "type": "string"
                },
                "nav_bar_title_color": {
                    "type": "string"
                },
                "nav_bar_button_color": {
                    "type": "string"
                },
                "tab_bar_translucent": {
                    "type": "boolean"
                },
                "nav_bar_translucent": {
                    "type": "boolean"
                },
                "nav_bar_title_image_width": {
                    "type": "number"
                },
                "nav_bar_title_image_height": {
                    "type": "number"
                },
                "nav_bar_side_margin": {
                    "type": "number"
                },
                "nav_bar_button_margins": {
                    "type": "number"
                },
                "nav_bar_button_width": {
                    "type": "number"
                },
                "nav_bar_button_height": {
                    "type": "number"
                },
                "nav_bar_button_spacing": {
                    "type": "number"
                },
                "nav_bar_cart_button_text_color": {
                    "type": "string"
                },
                "nav_bar_cart_button_font_size": {
                    "type": "number"
                },
                "nav_bar_cart_button_text_top_offset": {
                    "type": "number"
                },
                "nav_bar_title_font_size": {
                    "type": "number"
                },
                "tab_bar_font_size": {
                    "type": "number"
                },
                "side_menu_item_text_color": {
                    "type": "string"
                },
                "side_menu_item_font_size": {
                    "type": "number"
                },
                "side_menu_divider_color": {
                    "type": "string"
                },
                "side_menu_background_color": {
                    "type": "string"
                }
            },
            "additionalProperties": false
        }
    },
    "properties": {
        "schema_version": {
            "type": "number"
        },
        "config_version": {
            "type": "number"
        },
        "conf_file_url": {
            "type": "string"
        },
        "auto_conf_polling": {
            "type": "boolean"
        },
        "navigation_bar": {
            "$ref": "#/definition/navigation_bar"
        },
        "external_links": {
            "$ref": "#/definition/external_link_policy_set"
        },
        "sections_loading": {
            "$ref": "#/definition/sections_loading"
        },
        "sections": {
            "type": "array",
            "items": {
                "$ref": "#/definition/section"
            }
        },
        "login": {
            "type": "object",
            "properties": {
                "enable_form_detection": {
                    "type": "boolean"
                },
                "pre_fill_username": {
                    "type": "boolean"
                },
                "enable_biometrics": {
                    "type": "boolean"
                },
                "persistent_login": {
                    "type": "boolean"
                },
                "force_login": {
                    "type": "object",
                    "properties": {
                        "urls_to_hide": {
                            "type": "array",
                            "items": {
                                "$ref": "#/definition/url_matcher"
                            }
                        },
                        "section": {
                            "$ref": "#/definition/section"
                        }
                    },
                    "additionalProperties": false,
                    "required": ["section", "urls_to_hide"]
                },
                "use_default_credentials": {
                    "type": "boolean"
                },
                "default_username": {
                    "type": "string"
                },
                "default_password": {
                    "type": "string"
                },
                "auth_selectors": {
                    "type": "array",
                    "items": {
                        "type": "object",
                        "properties": {
                            "form": {
                                "type": "string"
                            },
                            "login": {
                                "type": "string"
                            },
                            "password": {
                                "type": "string"
                            },
                            "submit": {
                                "type": "string"
                            }
                        },
                        "required": ["form", "submit"],
                        "additionalProperties": false
                    }
                },
                "logged_in_state_check": {
                    "$ref": "#/definition/logged_in_check"
                }
            },
            "if": {
                "anyOf": [{
                        "properties": {
                            "persistent_login": {
                                "const": true
                            }
                        }
                    },
                    {
                        "not": {
                            "properties": {
                                "force_login": {
                                    "const": null
                                }
                            }
                        }
                    }
                ]
            },
            "then": {
                "properties": {
                    "target_logged_in_url": {
                        "type": "string"
                    }
                },
                "required": ["target_logged_in_url", "logged_in_state_check"]
            },
            "required": [
                "enable_form_detection", "pre_fill_username", "enable_biometrics", "persistent_login"
            ]
        },
        "style": {
            "$ref": "#/definition/style"
        },
        "style_android": {
            "$ref": "#/definition/style"
        },
        "custom": {
            "type": "object"
        }
    },
    "required": [
        "schema_version", "config_version", "conf_file_url", "auto_conf_polling", "navigation_bar"
    ],
    "additionalProperties": false
}
